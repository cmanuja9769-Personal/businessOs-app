# E-Way Bill API Implementation - Frontend Guide

## Overview
This document provides comprehensive guidance for implementing the frontend to communicate with the E-Way Bill backend API. The backend provides RESTful endpoints for generating, managing, and tracking E-Way Bills through the government's E-Way Bill portal.

---

## ðŸ“‹ Table of Contents
1. [API Endpoints Overview](#api-endpoints-overview)
2. [Authentication](#authentication)
3. [E-Way Bill Generation](#e-way-bill-generation)
4. [Vehicle Management](#vehicle-management)
5. [E-Way Bill Operations](#e-way-bill-operations)
6. [Error Handling](#error-handling)
7. [State Management](#state-management)
8. [UI Components](#ui-components)
9. [Testing Strategy](#testing-strategy)

---

## ðŸ”Œ API Endpoints Overview

### Base URL
```
Development: http://localhost:3001/api/v1
Production: https://your-domain.com/api/v1
```

### Available Endpoints

| Method | Endpoint | Purpose |
|--------|----------|---------|
| POST | `/e-waybill/generate` | Generate E-Way Bill |
| GET | `/e-waybill/:ewbNo` | Get E-Way Bill details |
| POST | `/e-waybill/update-vehicle` | Update vehicle number |
| POST | `/e-waybill/cancel` | Cancel E-Way Bill |
| POST | `/e-waybill/extend-validity` | Extend validity period |
| POST | `/e-waybill/consolidated` | Generate consolidated E-Way Bill |
| POST | `/e-waybill/reject` | Reject E-Way Bill (recipient) |
| GET | `/e-waybill/generated-by-others` | Get bills generated by others |

---

## ðŸ” Authentication

All E-Way Bill API endpoints require JWT authentication. Include the token in the Authorization header:

```typescript
// api/ewaybill.ts
import axios from 'axios';

const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api/v1';

const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Add auth token to all requests
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('authToken');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Handle token expiration
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // Redirect to login or refresh token
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default api;
```

---

## ðŸ“„ E-Way Bill Generation

### 1. Generate E-Way Bill from Invoice

```typescript
// types/ewaybill.types.ts
export interface GenerateEWayBillRequest {
  invoiceId: string;
}

export interface EWayBillResponse {
  success: boolean;
  data: {
    ewbNo: number;
    ewayBillDate: string;
    validUpto: string;
    alert?: string;
  };
  message: string;
}

// api/ewaybill.ts
export const generateEWayBill = async (
  invoiceId: string
): Promise<EWayBillResponse> => {
  const response = await api.post('/e-waybill/generate', { invoiceId });
  return response.data;
};
```

### 2. React Component Example

```typescript
// components/EWayBillGenerator.tsx
import React, { useState } from 'react';
import { generateEWayBill } from '../api/ewaybill';
import { toast } from 'react-hot-toast';

interface Props {
  invoice: Invoice;
  onSuccess: (ewbNo: number) => void;
}

export const EWayBillGenerator: React.FC<Props> = ({ invoice, onSuccess }) => {
  const [loading, setLoading] = useState(false);

  const handleGenerate = async () => {
    try {
      setLoading(true);
      
      const response = await generateEWayBill(invoice.id);
      
      if (response.success) {
        toast.success(`E-Way Bill generated: ${response.data.ewbNo}`);
        toast.success(`Valid until: ${new Date(response.data.validUpto).toLocaleString()}`);
        onSuccess(response.data.ewbNo);
      }
    } catch (error: any) {
      const errorMessage = error.response?.data?.message || 'Failed to generate E-Way Bill';
      toast.error(errorMessage);
      console.error('E-Way Bill generation error:', error);
    } finally {
      setLoading(false);
    }
  };

  // Check if invoice meets E-Way Bill criteria
  const requiresEWayBill = invoice.total > 50000; // â‚¹50,000 threshold

  return (
    <div className="ewaybill-generator">
      <div className="info-box">
        <h3>E-Way Bill Status</h3>
        {invoice.ewaybill_no ? (
          <div className="status-active">
            <p>âœ“ E-Way Bill Generated</p>
            <p className="ewb-number">EWB No: {invoice.ewaybill_no}</p>
            <p className="valid-until">
              Valid Until: {new Date(invoice.ewaybill_valid_upto).toLocaleString()}
            </p>
          </div>
        ) : requiresEWayBill ? (
          <div className="status-pending">
            <p>âš  E-Way Bill Required</p>
            <p className="info-text">
              Invoice amount exceeds â‚¹50,000. E-Way Bill is mandatory for transportation.
            </p>
            <button 
              onClick={handleGenerate} 
              disabled={loading}
              className="btn btn-primary"
            >
              {loading ? 'Generating...' : 'Generate E-Way Bill'}
            </button>
          </div>
        ) : (
          <div className="status-not-required">
            <p>â„¹ E-Way Bill Not Required</p>
            <p className="info-text">Invoice amount is below â‚¹50,000</p>
          </div>
        )}
      </div>
    </div>
  );
};
```

---

## ðŸš— Vehicle Management

### 1. Update Vehicle Number

```typescript
// api/ewaybill.ts
export interface UpdateVehicleRequest {
  ewbNo: number;
  vehicleNo: string;
  fromPlace: string;
  fromState: number; // State code
  reasonCode: '1' | '2' | '3' | '4'; // 1=Breakdown, 2=Transhipment, 3=Others, 4=First Time
  reasonRem?: string;
  transMode: '1' | '2' | '3' | '4'; // 1=Road, 2=Rail, 3=Air, 4=Ship
}

export const updateVehicleNumber = async (
  data: UpdateVehicleRequest
): Promise<any> => {
  const response = await api.post('/e-waybill/update-vehicle', data);
  return response.data;
};
```

### 2. Vehicle Update Component

```typescript
// components/VehicleUpdate.tsx
import React, { useState } from 'react';
import { updateVehicleNumber } from '../api/ewaybill';
import { toast } from 'react-hot-toast';

interface Props {
  ewbNo: number;
  currentVehicle?: string;
  onUpdate: () => void;
}

export const VehicleUpdate: React.FC<Props> = ({ ewbNo, currentVehicle, onUpdate }) => {
  const [formData, setFormData] = useState({
    vehicleNo: '',
    fromPlace: '',
    fromState: '',
    reasonCode: '4', // First Time
    reasonRem: '',
    transMode: '1', // Road
  });
  const [loading, setLoading] = useState(false);

  const reasonCodeOptions = [
    { value: '1', label: 'Breakdown' },
    { value: '2', label: 'Transhipment' },
    { value: '3', label: 'Others' },
    { value: '4', label: 'First Time' },
  ];

  const transModeOptions = [
    { value: '1', label: 'Road' },
    { value: '2', label: 'Rail' },
    { value: '3', label: 'Air' },
    { value: '4', label: 'Ship' },
  ];

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    try {
      setLoading(true);
      
      await updateVehicleNumber({
        ewbNo,
        ...formData,
        fromState: parseInt(formData.fromState),
        reasonCode: formData.reasonCode as any,
        transMode: formData.transMode as any,
      });
      
      toast.success('Vehicle number updated successfully');
      onUpdate();
    } catch (error: any) {
      toast.error(error.response?.data?.message || 'Failed to update vehicle');
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="vehicle-update-form">
      <h3>Update Vehicle Details</h3>
      
      {currentVehicle && (
        <div className="current-vehicle">
          <label>Current Vehicle:</label>
          <span>{currentVehicle}</span>
        </div>
      )}
      
      <div className="form-group">
        <label>New Vehicle Number *</label>
        <input
          type="text"
          value={formData.vehicleNo}
          onChange={(e) => setFormData({ ...formData, vehicleNo: e.target.value.toUpperCase() })}
          placeholder="MH12AB1234"
          required
        />
      </div>

      <div className="form-group">
        <label>From Place *</label>
        <input
          type="text"
          value={formData.fromPlace}
          onChange={(e) => setFormData({ ...formData, fromPlace: e.target.value })}
          placeholder="Mumbai"
          required
        />
      </div>

      <div className="form-group">
        <label>From State Code *</label>
        <input
          type="number"
          value={formData.fromState}
          onChange={(e) => setFormData({ ...formData, fromState: e.target.value })}
          placeholder="27"
          required
        />
      </div>

      <div className="form-group">
        <label>Reason *</label>
        <select
          value={formData.reasonCode}
          onChange={(e) => setFormData({ ...formData, reasonCode: e.target.value })}
          required
        >
          {reasonCodeOptions.map(opt => (
            <option key={opt.value} value={opt.value}>{opt.label}</option>
          ))}
        </select>
      </div>

      {formData.reasonCode === '3' && (
        <div className="form-group">
          <label>Reason Remarks</label>
          <textarea
            value={formData.reasonRem}
            onChange={(e) => setFormData({ ...formData, reasonRem: e.target.value })}
            placeholder="Explain the reason"
          />
        </div>
      )}

      <div className="form-group">
        <label>Transport Mode *</label>
        <select
          value={formData.transMode}
          onChange={(e) => setFormData({ ...formData, transMode: e.target.value })}
          required
        >
          {transModeOptions.map(opt => (
            <option key={opt.value} value={opt.value}>{opt.label}</option>
          ))}
        </select>
      </div>

      <button type="submit" disabled={loading} className="btn btn-primary">
        {loading ? 'Updating...' : 'Update Vehicle'}
      </button>
    </form>
  );
};
```

---

## ðŸ”„ E-Way Bill Operations

### 1. Get E-Way Bill Details

```typescript
// api/ewaybill.ts
export const getEWayBillDetails = async (ewbNo: number): Promise<any> => {
  const response = await api.get(`/e-waybill/${ewbNo}`);
  return response.data;
};

// components/EWayBillDetails.tsx
import React, { useEffect, useState } from 'react';
import { getEWayBillDetails } from '../api/ewaybill';

export const EWayBillDetails: React.FC<{ ewbNo: number }> = ({ ewbNo }) => {
  const [details, setDetails] = useState<any>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchDetails = async () => {
      try {
        const response = await getEWayBillDetails(ewbNo);
        setDetails(response.data);
      } catch (error) {
        console.error('Failed to fetch E-Way Bill details:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchDetails();
  }, [ewbNo]);

  if (loading) return <div>Loading...</div>;
  if (!details) return <div>No details available</div>;

  return (
    <div className="ewaybill-details">
      <h2>E-Way Bill Details</h2>
      
      <div className="detail-grid">
        <div className="detail-item">
          <label>EWB Number:</label>
          <span>{details.ewbNo}</span>
        </div>
        
        <div className="detail-item">
          <label>Status:</label>
          <span className={`status-badge status-${details.status.toLowerCase()}`}>
            {details.status}
          </span>
        </div>
        
        <div className="detail-item">
          <label>Valid Until:</label>
          <span>{new Date(details.validUpto).toLocaleString()}</span>
        </div>
        
        <div className="detail-item">
          <label>Vehicle Number:</label>
          <span>{details.vehicleNo}</span>
        </div>
        
        <div className="detail-item">
          <label>From:</label>
          <span>{details.fromTrdName} ({details.fromPlace})</span>
        </div>
        
        <div className="detail-item">
          <label>To:</label>
          <span>{details.toTrdName} ({details.toPlace})</span>
        </div>
        
        <div className="detail-item">
          <label>Distance:</label>
          <span>{details.transDistance} KM</span>
        </div>
        
        <div className="detail-item">
          <label>Invoice Value:</label>
          <span>â‚¹{details.totalInvoiceValue.toLocaleString()}</span>
        </div>
      </div>
    </div>
  );
};
```

### 2. Cancel E-Way Bill

```typescript
// api/ewaybill.ts
export interface CancelEWayBillRequest {
  ewbNo: number;
  cancelRsnCode: '1' | '2' | '3' | '4'; // 1=Duplicate, 2=Order Cancelled, 3=Data Entry Mistake, 4=Others
  cancelRmrk: string;
}

export const cancelEWayBill = async (
  data: CancelEWayBillRequest
): Promise<any> => {
  const response = await api.post('/e-waybill/cancel', data);
  return response.data;
};

// components/CancelEWayBill.tsx
import React, { useState } from 'react';
import { cancelEWayBill } from '../api/ewaybill';
import { toast } from 'react-hot-toast';

export const CancelEWayBill: React.FC<{ ewbNo: number; onCancel: () => void }> = ({ 
  ewbNo, 
  onCancel 
}) => {
  const [reasonCode, setReasonCode] = useState('1');
  const [remarks, setRemarks] = useState('');
  const [loading, setLoading] = useState(false);

  const reasonOptions = [
    { value: '1', label: 'Duplicate' },
    { value: '2', label: 'Order Cancelled' },
    { value: '3', label: 'Data Entry Mistake' },
    { value: '4', label: 'Others' },
  ];

  const handleCancel = async () => {
    if (!remarks.trim()) {
      toast.error('Please provide cancellation remarks');
      return;
    }

    if (window.confirm('Are you sure you want to cancel this E-Way Bill?')) {
      try {
        setLoading(true);
        
        await cancelEWayBill({
          ewbNo,
          cancelRsnCode: reasonCode as any,
          cancelRmrk: remarks,
        });
        
        toast.success('E-Way Bill cancelled successfully');
        onCancel();
      } catch (error: any) {
        toast.error(error.response?.data?.message || 'Failed to cancel E-Way Bill');
      } finally {
        setLoading(false);
      }
    }
  };

  return (
    <div className="cancel-ewaybill">
      <h3>Cancel E-Way Bill</h3>
      
      <div className="form-group">
        <label>Cancellation Reason *</label>
        <select value={reasonCode} onChange={(e) => setReasonCode(e.target.value)}>
          {reasonOptions.map(opt => (
            <option key={opt.value} value={opt.value}>{opt.label}</option>
          ))}
        </select>
      </div>

      <div className="form-group">
        <label>Remarks *</label>
        <textarea
          value={remarks}
          onChange={(e) => setRemarks(e.target.value)}
          placeholder="Explain why you're cancelling this E-Way Bill"
          rows={4}
          required
        />
      </div>

      <button 
        onClick={handleCancel} 
        disabled={loading}
        className="btn btn-danger"
      >
        {loading ? 'Cancelling...' : 'Cancel E-Way Bill'}
      </button>
    </div>
  );
};
```

### 3. Extend Validity

```typescript
// api/ewaybill.ts
export interface ExtendValidityRequest {
  ewbNo: number;
  vehicleNo: string;
  fromPlace: string;
  fromState: number;
  remainingDistance: number;
  extnRsnCode: '1' | '2' | '3' | '4' | '5'; // Natural Calamity, Law & Order, Transhipment, Accident, Others
  extnRemarks: string;
  consignmentStatus: 'M' | 'T'; // M=In Movement, T=In Transit
  transMode: '1' | '2' | '3' | '4';
}

export const extendEWayBillValidity = async (
  data: ExtendValidityRequest
): Promise<any> => {
  const response = await api.post('/e-waybill/extend-validity', data);
  return response.data;
};
```

---

## âš ï¸ Error Handling

### Comprehensive Error Handler

```typescript
// utils/errorHandler.ts
export interface APIError {
  message: string;
  code?: string;
  statusCode?: number;
  details?: any;
}

export const handleEWayBillError = (error: any): string => {
  // Network errors
  if (!error.response) {
    return 'Network error. Please check your connection.';
  }

  const { status, data } = error.response;

  // Map common E-Way Bill error codes
  const errorMessages: { [key: string]: string } = {
    '2002': 'E-Way Bill already exists for this invoice',
    '2003': 'Invoice value is below â‚¹50,000. E-Way Bill not required',
    '2008': 'E-Way Bill cannot be cancelled after 24 hours',
    '2010': 'Invalid GSTIN format',
    '2015': 'E-Way Bill has already been cancelled',
    '2020': 'E-Way Bill has expired',
    '2025': 'Vehicle number format is invalid',
    '4001': 'Authentication failed. Please check your credentials',
    '4003': 'Rate limit exceeded. Please try again later',
  };

  const errorCode = data?.error?.errorCode || data?.code;
  
  if (errorCode && errorMessages[errorCode]) {
    return errorMessages[errorCode];
  }

  // Default error messages by status code
  switch (status) {
    case 400:
      return data?.message || 'Invalid request data';
    case 401:
      return 'Session expired. Please login again';
    case 403:
      return 'You do not have permission to perform this action';
    case 404:
      return 'E-Way Bill not found';
    case 429:
      return 'Too many requests. Please try again later';
    case 500:
      return 'Server error. Please try again later';
    default:
      return data?.message || 'An unexpected error occurred';
  }
};
```

---

## ðŸ—„ï¸ State Management

### Redux Toolkit Example

```typescript
// store/slices/ewaybillSlice.ts
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import * as ewaybillAPI from '../../api/ewaybill';

interface EWayBillState {
  currentEWB: any | null;
  loading: boolean;
  error: string | null;
}

const initialState: EWayBillState = {
  currentEWB: null,
  loading: false,
  error: null,
};

export const generateEWB = createAsyncThunk(
  'ewaybill/generate',
  async (invoiceId: string, { rejectWithValue }) => {
    try {
      const response = await ewaybillAPI.generateEWayBill(invoiceId);
      return response.data;
    } catch (error: any) {
      return rejectWithValue(error.response?.data?.message || 'Failed to generate E-Way Bill');
    }
  }
);

export const updateVehicle = createAsyncThunk(
  'ewaybill/updateVehicle',
  async (data: ewaybillAPI.UpdateVehicleRequest, { rejectWithValue }) => {
    try {
      const response = await ewaybillAPI.updateVehicleNumber(data);
      return response.data;
    } catch (error: any) {
      return rejectWithValue(error.response?.data?.message);
    }
  }
);

export const cancelEWB = createAsyncThunk(
  'ewaybill/cancel',
  async (data: ewaybillAPI.CancelEWayBillRequest, { rejectWithValue }) => {
    try {
      const response = await ewaybillAPI.cancelEWayBill(data);
      return response.data;
    } catch (error: any) {
      return rejectWithValue(error.response?.data?.message);
    }
  }
);

const ewaybillSlice = createSlice({
  name: 'ewaybill',
  initialState,
  reducers: {
    clearError: (state) => {
      state.error = null;
    },
    clearCurrentEWB: (state) => {
      state.currentEWB = null;
    },
  },
  extraReducers: (builder) => {
    builder
      // Generate E-Way Bill
      .addCase(generateEWB.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(generateEWB.fulfilled, (state, action) => {
        state.loading = false;
        state.currentEWB = action.payload;
      })
      .addCase(generateEWB.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload as string;
      })
      // Update Vehicle
      .addCase(updateVehicle.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(updateVehicle.fulfilled, (state, action) => {
        state.loading = false;
        if (state.currentEWB) {
          state.currentEWB.vehicleNo = action.payload.vehicleNo;
        }
      })
      .addCase(updateVehicle.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload as string;
      })
      // Cancel E-Way Bill
      .addCase(cancelEWB.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(cancelEWB.fulfilled, (state) => {
        state.loading = false;
        state.currentEWB = null;
      })
      .addCase(cancelEWB.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload as string;
      });
  },
});

export const { clearError, clearCurrentEWB } = ewaybillSlice.actions;
export default ewaybillSlice.reducer;
```

---

## ðŸŽ¨ UI Components

### Complete E-Way Bill Management Component

```typescript
// pages/EWayBillManagement.tsx
import React, { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import { EWayBillGenerator } from '../components/EWayBillGenerator';
import { EWayBillDetails } from '../components/EWayBillDetails';
import { VehicleUpdate } from '../components/VehicleUpdate';
import { CancelEWayBill } from '../components/CancelEWayBill';
import { getInvoiceById } from '../api/invoices';

export const EWayBillManagement: React.FC = () => {
  const { invoiceId } = useParams<{ invoiceId: string }>();
  const [invoice, setInvoice] = useState<any>(null);
  const [activeTab, setActiveTab] = useState('generate');
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchInvoice();
  }, [invoiceId]);

  const fetchInvoice = async () => {
    try {
      const data = await getInvoiceById(invoiceId!);
      setInvoice(data);
      
      // If E-Way Bill exists, show details tab
      if (data.ewaybill_no) {
        setActiveTab('details');
      }
    } catch (error) {
      console.error('Failed to fetch invoice:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) return <div className="loading">Loading...</div>;
  if (!invoice) return <div className="error">Invoice not found</div>;

  return (
    <div className="ewaybill-management">
      <div className="page-header">
        <h1>E-Way Bill Management</h1>
        <div className="invoice-info">
          <span>Invoice: {invoice.invoice_number}</span>
          <span>Amount: â‚¹{invoice.total.toLocaleString()}</span>
        </div>
      </div>

      <div className="tabs">
        <button
          className={activeTab === 'generate' ? 'active' : ''}
          onClick={() => setActiveTab('generate')}
        >
          Generate
        </button>
        {invoice.ewaybill_no && (
          <>
            <button
              className={activeTab === 'details' ? 'active' : ''}
              onClick={() => setActiveTab('details')}
            >
              Details
            </button>
            <button
              className={activeTab === 'vehicle' ? 'active' : ''}
              onClick={() => setActiveTab('vehicle')}
            >
              Update Vehicle
            </button>
            <button
              className={activeTab === 'cancel' ? 'active' : ''}
              onClick={() => setActiveTab('cancel')}
            >
              Cancel
            </button>
          </>
        )}
      </div>

      <div className="tab-content">
        {activeTab === 'generate' && (
          <EWayBillGenerator
            invoice={invoice}
            onSuccess={() => fetchInvoice()}
          />
        )}
        
        {activeTab === 'details' && invoice.ewaybill_no && (
          <EWayBillDetails ewbNo={invoice.ewaybill_no} />
        )}
        
        {activeTab === 'vehicle' && invoice.ewaybill_no && (
          <VehicleUpdate
            ewbNo={invoice.ewaybill_no}
            currentVehicle={invoice.vehicle_number}
            onUpdate={() => fetchInvoice()}
          />
        )}
        
        {activeTab === 'cancel' && invoice.ewaybill_no && (
          <CancelEWayBill
            ewbNo={invoice.ewaybill_no}
            onCancel={() => fetchInvoice()}
          />
        )}
      </div>
    </div>
  );
};
```

---

## ðŸ§ª Testing Strategy

### Unit Tests Example

```typescript
// __tests__/ewaybill.test.ts
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { EWayBillGenerator } from '../components/EWayBillGenerator';
import * as ewaybillAPI from '../api/ewaybill';

jest.mock('../api/ewaybill');

describe('EWayBillGenerator', () => {
  const mockInvoice = {
    id: '123',
    invoice_number: 'INV-001',
    total: 60000,
    ewaybill_no: null,
  };

  it('should show generate button for eligible invoices', () => {
    render(<EWayBillGenerator invoice={mockInvoice} onSuccess={jest.fn()} />);
    expect(screen.getByText('Generate E-Way Bill')).toBeInTheDocument();
  });

  it('should generate E-Way Bill successfully', async () => {
    const mockResponse = {
      success: true,
      data: {
        ewbNo: 123456789012,
        ewayBillDate: '2024-01-01',
        validUpto: '2024-01-15',
      },
    };

    (ewaybillAPI.generateEWayBill as jest.Mock).mockResolvedValue(mockResponse);

    const onSuccess = jest.fn();
    render(<EWayBillGenerator invoice={mockInvoice} onSuccess={onSuccess} />);

    fireEvent.click(screen.getByText('Generate E-Way Bill'));

    await waitFor(() => {
      expect(onSuccess).toHaveBeenCalledWith(123456789012);
    });
  });

  it('should not show generate button for low-value invoices', () => {
    const lowValueInvoice = { ...mockInvoice, total: 30000 };
    render(<EWayBillGenerator invoice={lowValueInvoice} onSuccess={jest.fn()} />);
    expect(screen.queryByText('Generate E-Way Bill')).not.toBeInTheDocument();
  });
});
```

---

## ðŸ“ Best Practices

### 1. **Validation Before Generation**
```typescript
const validateEWayBillData = (invoice: Invoice): string[] => {
  const errors: string[] = [];
  
  if (!invoice.customer.gstin && invoice.total > 50000) {
    errors.push('Customer GSTIN required for E-Way Bill');
  }
  
  if (!invoice.items || invoice.items.length === 0) {
    errors.push('Invoice must have at least one item');
  }
  
  if (invoice.items.some(item => !item.hsn_code)) {
    errors.push('All items must have HSN codes');
  }
  
  return errors;
};
```

### 2. **Auto-refresh for Expiring E-Way Bills**
```typescript
useEffect(() => {
  if (invoice.ewaybill_valid_upto) {
    const validUpto = new Date(invoice.ewaybill_valid_upto);
    const now = new Date();
    const hoursRemaining = (validUpto.getTime() - now.getTime()) / (1000 * 60 * 60);
    
    if (hoursRemaining < 4 && hoursRemaining > 0) {
      toast.warning(`E-Way Bill expires in ${Math.floor(hoursRemaining)} hours!`);
    }
  }
}, [invoice]);
```

### 3. **Offline Support**
```typescript
// Store pending actions in IndexedDB for offline support
const queueOfflineAction = async (action: any) => {
  const db = await openDB('ewaybill-queue');
  await db.add('pending-actions', action);
};

// Sync when back online
window.addEventListener('online', async () => {
  const db = await openDB('ewaybill-queue');
  const pendingActions = await db.getAll('pending-actions');
  
  for (const action of pendingActions) {
    try {
      await executeAction(action);
      await db.delete('pending-actions', action.id);
    } catch (error) {
      console.error('Failed to sync:', error);
    }
  }
});
```

---

## ðŸ”’ Security Considerations

1. **Never log sensitive data** (GSTIN, vehicle numbers, etc.)
2. **Validate all user inputs** on frontend before API calls
3. **Use HTTPS** for all API communications
4. **Implement rate limiting** on the frontend to prevent abuse
5. **Store tokens securely** (HttpOnly cookies preferred over localStorage)
6. **Sanitize all user inputs** to prevent XSS attacks

---

## ðŸ“š Additional Resources

- [E-Way Bill Official Documentation](https://ewaybillgst.gov.in)
- [GST State Codes Reference](https://www.gst.gov.in/help/statecode)
- [HSN Code Lookup](https://www.gst.gov.in/hsncode)
- [Transport Mode Codes](https://ewaybillgst.gov.in/api-docs)

---

## ðŸŽ¯ Implementation Checklist

- [ ] Set up axios instance with auth interceptors
- [ ] Implement all API service functions
- [ ] Create E-Way Bill generator component
- [ ] Create vehicle update component
- [ ] Create cancellation component
- [ ] Create details view component
- [ ] Implement error handling
- [ ] Add state management (Redux/Context)
- [ ] Create validation utilities
- [ ] Add loading states and spinners
- [ ] Implement toast notifications
- [ ] Add unit tests
- [ ] Add integration tests
- [ ] Test with backend API
- [ ] Handle edge cases (expired bills, network errors, etc.)
- [ ] Add offline support
- [ ] Implement auto-refresh for expiring bills
- [ ] Add print functionality
- [ ] Create mobile-responsive UI

---

## ðŸš€ Quick Start Code

```typescript
// Complete setup in one file for quick testing
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:3001/api/v1',
  headers: { 'Content-Type': 'application/json' },
});

// Add auth token
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('authToken');
  if (token) config.headers.Authorization = `Bearer ${token}`;
  return config;
});

// Generate E-Way Bill
const generateEWayBill = async (invoiceId: string) => {
  try {
    const response = await api.post('/e-waybill/generate', { invoiceId });
    console.log('âœ“ E-Way Bill generated:', response.data);
    return response.data;
  } catch (error: any) {
    console.error('âœ— Error:', error.response?.data?.message);
    throw error;
  }
};

// Usage
generateEWayBill('your-invoice-id');
```

---

**Last Updated:** December 2024  
**Backend Version:** 1.0.0  
**API Version:** v1

For questions or support, contact: support@yourdomain.com
